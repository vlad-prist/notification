# Сервис рассылки на Django (DRF)
Данный сервис является частью микросервисной архитектуры, которая обеспечивает работу большого проекта в части 
уведомлений пользорвателей на email или в telegram.


## Использование
Для работы с данным проектом:

* Клонировать репозиторий. https://github.com/vlad-prist/notification.git

* В виртуальном окружении установите **requirements.txt** (пакет с зависимостями) с помощью команды:
```sh
$ pip install -r requirements.txt
```
* Добавьте в свой проект файл **.env** необходимыми для работы паролями.
Пример **.env.sample** размещен в проекте.
P.S. Добавлена переменная `ENVTYPE` которая необходима для определения переменной окружения для подключения к хосту.
в ***.env*** определен хост для подключения к PostgreSQL

## Разработка

### Реализовано в проекте
В данном проекте реализовано приложение `notify`, в котором :


Для корректной отправки рассылок обязательно установить **eventlet**
и для запуска отправки рыссылок выполнить команду:
```sh
$ celery -A config worker --loglevel=info -P eventlet
```


## Спецификация
Сервис должен имеет точку входа: **/api/notify/**

Тело запроса должно обязательно включает следующие параметры:

```sh
{
  "message_text": string(1024),
  "recipients": string(150) | list[string(150)],
  "delay": int
  "scheduled_time": string(format %d.%m.%Y %H:%M) # необязательный параметр 
}
```
Параметр **message_text** содержит обычный текст, который будет отправлен в сообщении

Параметр **recipients** может содержать одного получателя или список получателей.
Получателей можно добавить через end-point **/api/recipient/create/**
Для каждого получателя определен адрес отправки либо почта, либо telegram.
В получателе telegram всегда только числа, почта оформлена по общей маске почтового адреса.

Параметр **delay** отвечает за задержку отправки, где:

**0** - отправлять без задержки, при получении запроса

**1** - отправить с задержкой в 1 час

**2** - отправить с задержкой в 1 день


При получении, сообщение складываться в отдельную таблицу в БД.
А по результатам рассылки записывается лог о попытке отправки в БД.
Сама отправка должна осуществляется с помощью очереди через celery.

Для корректной отправки рассылок обязательно установить **eventlet**
и для запуска отправки рассылок выполнить команду:
```sh
$ celery -A config worker --loglevel=info -P eventlet
```


## Технические требования


1. **Язык программирования:**
    - Python 3.12
2. **Фреймворк:**
    - Django для реализации REST API с использованием Django REST Framework (DRF)
3. **База данных:**
    - PostgreSQL для хранения данных
4. **ORM:**
    - Django ORM для взаимодействия с базой данных
5. **Документация:**
    - В корне проекта размещен файл README.md с описанием структуры проекта, инструкциями по установке и запуску, а также описанием API.
6. **Качество кода:**
    - Соблюдены стандарты PEP8 для Python кода.
7. **Автодокументация:**
    - Реализована автогенерируемая документация API с использованием Swagger и/или ReDoc.
